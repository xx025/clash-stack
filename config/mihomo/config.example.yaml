# Mihomo é…ç½®ç¤ºä¾‹ï¼ˆå¤åˆ¶ä¸º config.yaml åä½¿ç”¨ï¼‰
# ä¿®æ”¹åæ‰§è¡Œ: docker compose restart mihomo

mixed-port: 7890
allow-lan: true
bind-address: "*"
lan-allowed-ips:
  - 0.0.0.0/0
  - "::/0"

mode: rule
log-level: info
external-controller: 0.0.0.0:9090

dns:
  enable: true
  ipv6: false
  enhanced-mode: fake-ip
  nameserver:
    - 223.5.5.5
    - 119.29.29.29

proxies: []

# è¿œç¨‹è§„åˆ™é›†ï¼ˆè‡ªåŠ¨æ›´æ–°ï¼Œæ— éœ€æ‰‹å†™ï¼‰
rule-providers:
  reject:
    type: http
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/reject.txt"
    path: ./ruleset/reject.yaml
    interval: 86400
  proxy:
    type: http
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/proxy.txt"
    path: ./ruleset/proxy.yaml
    interval: 86400
  direct:
    type: http
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/direct.txt"
    path: ./ruleset/direct.yaml
    interval: 86400

rules:
  - RULE-SET,reject,REJECT
  - RULE-SET,proxy,ğŸš€ èŠ‚ç‚¹é€‰æ‹©
  - RULE-SET,direct,DIRECT
  - GEOIP,CN,DIRECT
  - MATCH,ğŸš€ èŠ‚ç‚¹é€‰æ‹©

# ========== è®¢é˜…é“¾æ¥å¡«å†™è¯´æ˜ ==========
# èŠ‚ç‚¹æ¥è‡ª Sub-Storeï¼Œè¯·æŒ‰ä¸‹é¢æ­¥éª¤è·å–é“¾æ¥å¹¶æ›¿æ¢ä¸‹æ–¹çš„ urlï¼š
#
# 1. æ‰“å¼€ Sub-Store é¡µé¢ï¼šhttp://<ä½ çš„æœåŠ¡å™¨IP>:7893
# 2. åœ¨ã€Œè®¢é˜…ã€é‡Œæ·»åŠ ä½ çš„æœºåœº/è®¢é˜…ï¼Œæˆ–åˆ›å»ºã€Œåˆé›†ã€æŠŠå¤šä¸ªè®¢é˜…åˆå¹¶
# 3. ç‚¹å‡»è¯¥è®¢é˜…/åˆé›†å³ä¾§çš„ã€Œåˆ†äº«ã€æˆ–ã€Œå¤åˆ¶é“¾æ¥ã€
# 4. é“¾æ¥æ ¼å¼é€šå¸¸ä¸ºï¼š
#    http://<Sub-Storeåœ°å€>:7893/share/col/<åˆé›†å>?token=<ä½ çš„token>&target=ClashMeta
#    æˆ– /share/sub/<è®¢é˜…å>?token=xxx&target=ClashMeta
# 5. å°†ä¸‹é¢ my-sub çš„ url æ¢æˆä½ å¤åˆ¶çš„å®Œæ•´é“¾æ¥ï¼ˆå¿…é¡»å¸¦ target=ClashMetaï¼‰
# 6. è‹¥ Sub-Store æœ‰è®¾ç½® API è·¯å¾„ï¼ˆå¦‚ /apiï¼‰ï¼Œåˆ†äº«é“¾æ¥é‡Œå·²åŒ…å«åˆ™æ— éœ€æ”¹
#
proxy-providers:
  my-sub:
    type: http
    # è¯·æ›¿æ¢ä¸ºä½ çš„ Sub-Store è®¢é˜…/åˆé›†åˆ†äº«é“¾æ¥ï¼ˆtarget=ClashMetaï¼‰
    url: "http://YOUR_SERVER_IP:7893/share/col/YOUR_COLLECTION?token=YOUR_TOKEN&target=ClashMeta"
    interval: 3600
    path: ./proxies/my-sub.yaml
    health-check:
      enable: true
      url: http://www.gstatic.com/generate_204
      interval: 300

proxy-groups:
  - name: ğŸš€ èŠ‚ç‚¹é€‰æ‹©
    type: select
    use: [my-sub]
